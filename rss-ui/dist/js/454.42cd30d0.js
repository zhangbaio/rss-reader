"use strict";(self["webpackChunkrss_reader"]=self["webpackChunkrss_reader"]||[]).push([[454],{1256:function(e,a,t){t.d(a,{GE:function(){return i},YE:function(){return c},aI:function(){return r},dw:function(){return u},lF:function(){return s},vO:function(){return n},xp:function(){return d}});var l=t(4410);function i(e){return l.A.get("/articles",{params:e})}function n(e){return l.A.get(`/articles/${e}`)}function r(e){return l.A.put(`/articles/${e}/read`,null,{params:{isRead:1}})}function s(e){return l.A.put(`/articles/${e}/read`,null,{params:{isRead:0}})}function c(e){return l.A.post("/articles/batch-read",e,{params:{isRead:1}})}function u(e){return l.A.put(`/articles/${e}/favorite`)}function d(e){return l.A.get(`/articles/${e}/fullcontent`)}},3555:function(e,a,t){t.d(a,{A:function(){return $}});var l=t(6768),i=t(4232),n=t(144),r=t(6933),s=(t(4114),t(8728));const c={class:"card-main"},u={class:"card-header"},d={class:"feed-name"},o={class:"publish-time"},v={class:"card-title"},f={key:0,class:"card-summary"},p={class:"card-footer"},m={class:"word-count"},g={class:"read-time"},k={key:0,class:"card-thumbnail"},h=["src","alt"];var R=(0,l.pM)({__name:"ArticleCard",props:{article:{},active:{type:Boolean}},emits:["click"],setup(e,{emit:a}){const t=e,n=a,r=(0,s.rd)(),R=(0,l.EW)(()=>{const e=t.article.enclosureType||"";return e.startsWith("image/")});function A(){r.push(`/reader/${t.article.id}`),n("click")}function _(e){const a=new Date(e),t=new Date,l=t.getTime()-a.getTime(),i=Math.floor(l/6e4),n=Math.floor(l/36e5),r=Math.floor(l/864e5);return i<1?"刚刚":i<60?`${i}分钟前`:n<24?`${n}小时前`:r<7?`${r}天前`:a.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})}function b(e){const a=120,t=e.replace(/<[^>]*>/g,"").trim();return t.length<=a?t:t.slice(0,a)+"..."}function y(e){if(!e)return 0;const a=e.replace(/<[^>]*>/g,"").trim();return a.length}function C(e){const a=y(e);return Math.max(1,Math.ceil(a/300))}return(a,t)=>((0,l.uX)(),(0,l.CE)("div",{class:(0,i.C4)(["article-card",{unread:0===e.article.isRead,active:e.active}]),onClick:A},[(0,l.Lk)("div",c,[(0,l.Lk)("div",u,[(0,l.Lk)("span",d,(0,i.v_)(e.article.feedName),1),(0,l.Lk)("span",o,(0,i.v_)(_(e.article.pubDate)),1)]),(0,l.Lk)("h3",v,(0,i.v_)(e.article.title),1),e.article.description?((0,l.uX)(),(0,l.CE)("p",f,(0,i.v_)(b(e.article.description)),1)):(0,l.Q3)("",!0),(0,l.Lk)("div",p,[(0,l.Lk)("span",m,(0,i.v_)(y(e.article.description))+" 字",1),(0,l.Lk)("span",g,(0,i.v_)(C(e.article.description))+" min",1)])]),e.article.enclosureUrl&&R.value?((0,l.uX)(),(0,l.CE)("div",k,[(0,l.Lk)("img",{src:e.article.enclosureUrl,alt:e.article.title},null,8,h)])):(0,l.Q3)("",!0)],2))}}),A=t(1241);const _=(0,A.A)(R,[["__scopeId","data-v-7d3daed4"]]);var b=_;const y={class:"article-list"},C={class:"list-header"},F={class:"list-title"},E={class:"list-actions"},L={key:0,class:"empty-state"},w={class:"articles-grid"},I={key:1,class:"loading-more"},M={key:2,class:"no-more"};var X=(0,l.pM)({__name:"ArticleList",props:{title:{},feedId:{}},emits:["select"],setup(e,{emit:a}){const t=e,s=a,c=(0,r.N)(),u=(0,n.KR)(null),d=(0,n.KR)("all"),o=(0,l.EW)(()=>"unread"===d.value?c.unreadArticles:c.articles);function v(e){s("select",e)}async function f(){await c.markAllAsRead()}function p(){if(!u.value)return;const{scrollTop:e,scrollHeight:a,clientHeight:t}=u.value;a-e-t<100&&!c.loading&&c.hasMore&&c.fetchArticles()}return(0,l.wB)(()=>t.feedId,()=>{c.setFilter({feedId:t.feedId}),c.fetchArticles(!0)},{immediate:!0}),(0,l.wB)(d,()=>{c.setFilter({isRead:"unread"===d.value?0:void 0}),c.fetchArticles(!0)}),(0,l.sV)(()=>{u.value?.addEventListener("scroll",p)}),(0,l.hi)(()=>{u.value?.removeEventListener("scroll",p)}),(a,t)=>{const r=(0,l.g2)("el-radio-button"),s=(0,l.g2)("el-radio-group"),p=(0,l.g2)("Check"),m=(0,l.g2)("el-icon"),g=(0,l.g2)("el-button"),k=(0,l.g2)("Document"),h=(0,l.g2)("Loading"),R=(0,l.gN)("loading");return(0,l.uX)(),(0,l.CE)("div",y,[(0,l.Lk)("div",C,[(0,l.Lk)("h2",F,(0,i.v_)(e.title),1),(0,l.Lk)("div",E,[(0,l.bF)(s,{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=e=>d.value=e),size:"small"},{default:(0,l.k6)(()=>[(0,l.bF)(r,{label:"all"},{default:(0,l.k6)(()=>[...t[1]||(t[1]=[(0,l.eW)("全部",-1)])]),_:1}),(0,l.bF)(r,{label:"unread"},{default:(0,l.k6)(()=>[...t[2]||(t[2]=[(0,l.eW)("未读",-1)])]),_:1})]),_:1},8,["modelValue"]),(0,l.bF)(g,{text:"",onClick:f,disabled:0===(0,n.R1)(c).unreadArticles.length},{default:(0,l.k6)(()=>[(0,l.bF)(m,null,{default:(0,l.k6)(()=>[(0,l.bF)(p)]),_:1}),t[3]||(t[3]=(0,l.eW)(" 全部已读 ",-1))]),_:1},8,["disabled"])])]),(0,l.bo)(((0,l.uX)(),(0,l.CE)("div",{class:"list-content",ref_key:"listRef",ref:u},[0!==o.value.length||(0,n.R1)(c).loading?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",L,[(0,l.bF)(m,{size:48},{default:(0,l.k6)(()=>[(0,l.bF)(k)]),_:1}),t[4]||(t[4]=(0,l.Lk)("p",null,"暂无文章",-1))])),(0,l.Lk)("div",w,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.value,e=>((0,l.uX)(),(0,l.Wv)(b,{key:e.id,article:e,onClick:a=>v(e)},null,8,["article","onClick"]))),128))]),(0,n.R1)(c).loading&&(0,n.R1)(c).articles.length>0?((0,l.uX)(),(0,l.CE)("div",I,[(0,l.bF)(m,{class:"is-loading"},{default:(0,l.k6)(()=>[(0,l.bF)(h)]),_:1}),t[5]||(t[5]=(0,l.Lk)("span",null,"加载中...",-1))])):(0,l.Q3)("",!0),!(0,n.R1)(c).hasMore&&(0,n.R1)(c).articles.length>0?((0,l.uX)(),(0,l.CE)("div",M," 没有更多了 ")):(0,l.Q3)("",!0)])),[[R,(0,n.R1)(c).loading&&0===(0,n.R1)(c).articles.length]])])}}});const K=(0,A.A)(X,[["__scopeId","data-v-4d776ab8"]]);var $=K},6073:function(e,a,t){t.r(a),t.d(a,{default:function(){return d}});var l=t(6768),i=t(3555),n=t(6933);const r={class:"home-view"};var s=(0,l.pM)({__name:"Home",setup(e){const a=(0,n.N)();async function t(e){0===e.isRead&&await a.markAsRead(e.id)}return(e,a)=>((0,l.uX)(),(0,l.CE)("div",r,[(0,l.bF)(i.A,{title:"全部文章",onSelect:t})]))}}),c=t(1241);const u=(0,c.A)(s,[["__scopeId","data-v-0ba82629"]]);var d=u},6933:function(e,a,t){t.d(a,{N:function(){return c}});t(4114),t(8111),t(2489),t(116),t(7588),t(1701);var l=t(2261),i=t(6768),n=t(144),r=t(1256),s=t(7580);const c=(0,l.nY)("article",()=>{const e=(0,n.KR)([]),a=(0,n.KR)(null),t=(0,n.KR)(!1),l=(0,n.KR)(!0),c=(0,n.KR)(0),u=(0,n.KR)({page:1,size:20,feedId:void 0,isRead:void 0,isFavorite:void 0}),d=(0,i.EW)(()=>e.value.filter(e=>0===e.isRead));async function o(a=!1){if(a&&(u.value.page=1,e.value=[],l.value=!0),l.value){t.value=!0;try{const t=await r.GE(u.value);a?e.value=t.data:e.value.push(...t.data),c.value=t.total,l.value=u.value.page<t.totalPages,u.value.page++}finally{t.value=!1}}}async function v(e){t.value=!0;try{a.value=await r.vO(e),a.value&&0===a.value.isRead&&await f(e)}finally{t.value=!1}}async function f(t){await r.aI(t);const l=e.value.find(e=>e.id===t);if(l&&0===l.isRead){l.isRead=1;const e=(0,s.p)();e.decreaseUnreadCount(l.feedId)}a.value?.id===t&&(a.value.isRead=1)}async function p(t){await r.lF(t);const l=e.value.find(e=>e.id===t);if(l&&1===l.isRead){l.isRead=0;const e=(0,s.p)();e.increaseUnreadCount(l.feedId)}a.value?.id===t&&(a.value.isRead=0)}async function m(){const a=e.value.filter(e=>0===e.isRead).map(e=>e.id);if(0===a.length)return;await r.YE(a);const t=(0,s.p)();e.value.forEach(e=>{0===e.isRead&&(e.isRead=1,t.decreaseUnreadCount(e.feedId))})}async function g(t){await r.dw(t);const l=e.value.find(e=>e.id===t);l&&(l.isFavorite=1===l.isFavorite?0:1),a.value?.id===t&&(a.value.isFavorite=1===a.value.isFavorite?0:1)}function k(e){u.value={...u.value,...e,page:1}}function h(){a.value=null}return{articles:e,currentArticle:a,loading:t,hasMore:l,total:c,queryParams:u,unreadArticles:d,fetchArticles:o,fetchArticle:v,markAsRead:f,markAsUnread:p,markAllAsRead:m,toggleFavorite:g,setFilter:k,clearCurrentArticle:h}})}}]);
//# sourceMappingURL=454.42cd30d0.js.map