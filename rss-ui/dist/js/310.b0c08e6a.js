"use strict";(self["webpackChunkrss_reader"]=self["webpackChunkrss_reader"]||[]).push([[310],{1256:function(e,a,l){l.d(a,{GE:function(){return n},YE:function(){return o},aI:function(){return s},dw:function(){return c},lF:function(){return u},vO:function(){return i},xp:function(){return r}});var t=l(4410);function n(e){return t.A.get("/articles",{params:e})}function i(e){return t.A.get(`/articles/${e}`)}function s(e){return t.A.put(`/articles/${e}/read`,null,{params:{isRead:1}})}function u(e){return t.A.put(`/articles/${e}/read`,null,{params:{isRead:0}})}function o(e){return t.A.post("/articles/batch-read",e,{params:{isRead:1}})}function c(e){return t.A.put(`/articles/${e}/favorite`)}function r(e){return t.A.get(`/articles/${e}/fullcontent`)}},3310:function(e,a,l){l.r(a),l.d(a,{default:function(){return Je}});l(4114),l(8111),l(1701),l(4603),l(7566),l(8721);var t=l(6768),n=l(4232),i=l(5130),s=l(144),u=l(8728),o=l(6933),c=l(4351),r=(l(2489),l(116),l(2261)),v=l(4410);function d(e){return v.A.get(`/highlights/article/${e}`)}function g(e){return v.A.post("/highlights",e)}function f(e,a){return v.A.put(`/highlights/${e}`,a)}function k(e){return v.A.delete(`/highlights/${e}`)}function h(){return v.A.get("/highlights/tags")}function p(e,a){return v.A.post("/highlights/tags",null,{params:{name:e,color:a}})}const m=(0,r.nY)("highlight",()=>{const e=(0,s.KR)([]),a=(0,s.KR)([]),l=(0,s.KR)(!1),t=(0,s.KR)(null);async function n(a){if(!(t.value===a&&e.value.length>0)){l.value=!0,t.value=a;try{e.value=await d(a)}finally{l.value=!1}}}async function i(a){const l=await g(a);return e.value.push(l),l}async function u(a,l){const t=await f(a,l),n=e.value.findIndex(e=>e.id===a);return-1!==n&&(e.value[n]=t),t}async function o(a){await k(a),e.value=e.value.filter(e=>e.id!==a)}async function c(){a.value=await h()}async function r(e,l){const t=await p(e,l);return a.value.find(e=>e.id===t.id)||a.value.push(t),t}function v(){e.value=[],t.value=null}return{highlights:e,tags:a,loading:l,currentArticleId:t,fetchHighlights:n,createHighlight:i,updateHighlight:u,deleteHighlight:o,fetchTags:c,createTag:r,clearHighlights:v}});function b(e){return v.A.get(`/notes/article/${e}`)}function y(e,a){return v.A.post("/notes",{articleId:e,noteContent:a})}function R(e){return v.A.delete(`/notes/article/${e}`)}const L=(0,r.nY)("note",()=>{const e=(0,s.KR)(null),a=(0,s.KR)(!1),l=(0,s.KR)(!1),t=(0,s.KR)(null);async function n(l){if(t.value!==l||!e.value){a.value=!0,t.value=l;try{e.value=await b(l)}finally{a.value=!1}}}async function i(a,t){l.value=!0;try{e.value=await y(a,t)}finally{l.value=!1}}async function u(a){await R(a),e.value=null}function o(){e.value=null,t.value=null}return{note:e,loading:a,saving:l,currentArticleId:t,fetchNote:n,saveNote:i,deleteNote:u,clearNote:o}});var F=l(1256);const C={class:"reading-settings"},_={class:"setting-item"},w={class:"setting-label"},E={class:"setting-value"},A={class:"setting-item"},K={class:"setting-label"},W={class:"setting-value"},x={class:"setting-item"},X={class:"setting-label"},S={class:"setting-value"},T={class:"setting-item"},I={class:"setting-item"},V={class:"setting-actions"};var z=(0,t.pM)({__name:"ReadingSettings",setup(e){const a=(0,c.C)();return(e,l)=>{const i=(0,t.g2)("Setting"),u=(0,t.g2)("el-icon"),o=(0,t.g2)("el-button"),c=(0,t.g2)("el-slider"),r=(0,t.g2)("el-option"),v=(0,t.g2)("el-select"),d=(0,t.g2)("el-radio-button"),g=(0,t.g2)("el-radio-group"),f=(0,t.g2)("el-popover");return(0,t.uX)(),(0,t.Wv)(f,{placement:"bottom-end",width:320,trigger:"click"},{reference:(0,t.k6)(()=>[(0,t.bF)(o,{text:"",circle:""},{default:(0,t.k6)(()=>[(0,t.bF)(u,{size:18},{default:(0,t.k6)(()=>[(0,t.bF)(i)]),_:1})]),_:1})]),default:(0,t.k6)(()=>[(0,t.Lk)("div",C,[l[14]||(l[14]=(0,t.Lk)("h4",{class:"settings-title"},"阅读设置",-1)),(0,t.Lk)("div",_,[(0,t.Lk)("div",w,[l[5]||(l[5]=(0,t.Lk)("span",null,"字体大小",-1)),(0,t.Lk)("span",E,(0,n.v_)((0,s.R1)(a).reading.fontSize)+"px",1)]),(0,t.bF)(c,{modelValue:(0,s.R1)(a).reading.fontSize,"onUpdate:modelValue":l[0]||(l[0]=e=>(0,s.R1)(a).reading.fontSize=e),min:14,max:24,step:1,"show-tooltip":!1},null,8,["modelValue"])]),(0,t.Lk)("div",A,[(0,t.Lk)("div",K,[l[6]||(l[6]=(0,t.Lk)("span",null,"行高",-1)),(0,t.Lk)("span",W,(0,n.v_)((0,s.R1)(a).reading.lineHeight.toFixed(1)),1)]),(0,t.bF)(c,{modelValue:(0,s.R1)(a).reading.lineHeight,"onUpdate:modelValue":l[1]||(l[1]=e=>(0,s.R1)(a).reading.lineHeight=e),min:1.4,max:2.4,step:.1,"show-tooltip":!1},null,8,["modelValue"])]),(0,t.Lk)("div",x,[(0,t.Lk)("div",X,[l[7]||(l[7]=(0,t.Lk)("span",null,"内容宽度",-1)),(0,t.Lk)("span",S,(0,n.v_)((0,s.R1)(a).reading.contentWidth)+"px",1)]),(0,t.bF)(c,{modelValue:(0,s.R1)(a).reading.contentWidth,"onUpdate:modelValue":l[2]||(l[2]=e=>(0,s.R1)(a).reading.contentWidth=e),min:600,max:1e3,step:50,"show-tooltip":!1},null,8,["modelValue"])]),(0,t.Lk)("div",T,[l[8]||(l[8]=(0,t.Lk)("div",{class:"setting-label"},[(0,t.Lk)("span",null,"字体")],-1)),(0,t.bF)(v,{modelValue:(0,s.R1)(a).reading.fontFamily,"onUpdate:modelValue":l[3]||(l[3]=e=>(0,s.R1)(a).reading.fontFamily=e),style:{width:"100%"},size:"small"},{default:(0,t.k6)(()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)((0,s.R1)(a).fontOptions,e=>((0,t.uX)(),(0,t.Wv)(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),(0,t.Lk)("div",I,[l[12]||(l[12]=(0,t.Lk)("div",{class:"setting-label"},[(0,t.Lk)("span",null,"主题")],-1)),(0,t.bF)(g,{modelValue:(0,s.R1)(a).app.theme,"onUpdate:modelValue":l[4]||(l[4]=e=>(0,s.R1)(a).app.theme=e),size:"small"},{default:(0,t.k6)(()=>[(0,t.bF)(d,{label:"light"},{default:(0,t.k6)(()=>[...l[9]||(l[9]=[(0,t.eW)("浅色",-1)])]),_:1}),(0,t.bF)(d,{label:"dark"},{default:(0,t.k6)(()=>[...l[10]||(l[10]=[(0,t.eW)("深色",-1)])]),_:1}),(0,t.bF)(d,{label:"system"},{default:(0,t.k6)(()=>[...l[11]||(l[11]=[(0,t.eW)("跟随系统",-1)])]),_:1})]),_:1},8,["modelValue"])]),(0,t.Lk)("div",V,[(0,t.bF)(o,{size:"small",onClick:(0,s.R1)(a).resetReadingSettings},{default:(0,t.k6)(()=>[...l[13]||(l[13]=[(0,t.eW)(" 恢复默认 ",-1)])]),_:1},8,["onClick"])])])]),_:1})}}}),$=l(1241);const H=(0,$.A)(z,[["__scopeId","data-v-a6016420"]]);var N=H,M=l(7477);const U={class:"color-picker"},Q=["onClick","title"],D={class:"action-btn",title:"添加标签"},O={class:"tag-selector"},G={key:0,class:"tag-list"},P={class:"action-btn",title:"添加备注"},B={class:"note-editor"},Y={class:"note-actions"};var q=(0,t.pM)({__name:"HighlightToolbar",props:{visible:{type:Boolean},position:{},selectedText:{},allTags:{}},emits:["save","cancel"],setup(e,{emit:a}){const l=e,u=a,o=[{value:"yellow",bg:"#fef08a",label:"黄色"},{value:"green",bg:"#bbf7d0",label:"绿色"},{value:"blue",bg:"#bfdbfe",label:"蓝色"},{value:"pink",bg:"#fbcfe8",label:"粉色"},{value:"purple",bg:"#ddd6fe",label:"紫色"}],c=(0,s.KR)("yellow"),r=(0,s.KR)([]),v=(0,s.KR)(""),d=(0,s.KR)(""),g=(0,s.KR)(!1),f=(0,s.KR)(!1),k=(0,t.EW)(()=>({left:`${l.position.x}px`,top:`${l.position.y}px`}));function h(e){c.value=e}function p(e){const a=r.value.indexOf(e);a>-1?r.value.splice(a,1):r.value.push(e)}function m(){d.value.trim()&&(r.value.includes(d.value.trim())||r.value.push(d.value.trim()),d.value="")}function b(){u("save",{color:c.value,note:v.value,tags:r.value})}function y(){f.value=!1,b()}function R(){u("cancel")}return(0,t.wB)(()=>l.visible,e=>{e&&(c.value="yellow",r.value=[],v.value="",d.value="",g.value=!1,f.value=!1)}),(a,l)=>{const u=(0,t.g2)("el-icon"),L=(0,t.g2)("el-button"),F=(0,t.g2)("el-input"),C=(0,t.g2)("el-tag"),_=(0,t.g2)("el-popover");return(0,t.uX)(),(0,t.Wv)(t.Im,{to:"body"},[e.visible?((0,t.uX)(),(0,t.CE)("div",{key:0,class:"highlight-toolbar",style:(0,n.Tr)(k.value),onMousedown:l[5]||(l[5]=(0,i.D$)(()=>{},["stop"]))},[(0,t.Lk)("div",U,[((0,t.uX)(),(0,t.CE)(t.FK,null,(0,t.pI)(o,e=>(0,t.Lk)("button",{key:e.value,class:(0,n.C4)(["color-btn",{active:c.value===e.value}]),style:(0,n.Tr)({backgroundColor:e.bg}),onClick:a=>h(e.value),title:e.label},null,14,Q)),64))]),l[9]||(l[9]=(0,t.Lk)("div",{class:"divider"},null,-1)),(0,t.bF)(_,{placement:"bottom",width:200,trigger:"click",visible:g.value,"onUpdate:visible":l[1]||(l[1]=e=>g.value=e)},{reference:(0,t.k6)(()=>[(0,t.Lk)("button",D,[(0,t.bF)(u,null,{default:(0,t.k6)(()=>[(0,t.bF)((0,s.R1)(M.PriceTag))]),_:1}),l[6]||(l[6]=(0,t.Lk)("span",null,"Add tags",-1))])]),default:(0,t.k6)(()=>[(0,t.Lk)("div",O,[(0,t.bF)(F,{modelValue:d.value,"onUpdate:modelValue":l[0]||(l[0]=e=>d.value=e),size:"small",placeholder:"输入标签名称",onKeyup:(0,i.jR)(m,["enter"])},{append:(0,t.k6)(()=>[(0,t.bF)(L,{onClick:m},{default:(0,t.k6)(()=>[(0,t.bF)(u,null,{default:(0,t.k6)(()=>[(0,t.bF)((0,s.R1)(M.Plus))]),_:1})]),_:1})]),_:1},8,["modelValue"]),e.allTags.length>0?((0,t.uX)(),(0,t.CE)("div",G,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(e.allTags,e=>((0,t.uX)(),(0,t.Wv)(C,{key:e.id,type:r.value.includes(e.name)?"":"info",class:"tag-item",onClick:a=>p(e.name)},{default:(0,t.k6)(()=>[(0,t.eW)((0,n.v_)(e.name),1)]),_:2},1032,["type","onClick"]))),128))])):(0,t.Q3)("",!0)])]),_:1},8,["visible"]),(0,t.bF)(_,{placement:"bottom",width:280,trigger:"click",visible:f.value,"onUpdate:visible":l[4]||(l[4]=e=>f.value=e)},{reference:(0,t.k6)(()=>[(0,t.Lk)("button",P,[(0,t.bF)(u,null,{default:(0,t.k6)(()=>[(0,t.bF)((0,s.R1)(M.EditPen))]),_:1})])]),default:(0,t.k6)(()=>[(0,t.Lk)("div",B,[(0,t.bF)(F,{modelValue:v.value,"onUpdate:modelValue":l[2]||(l[2]=e=>v.value=e),type:"textarea",rows:3,placeholder:"添加备注..."},null,8,["modelValue"]),(0,t.Lk)("div",Y,[(0,t.bF)(L,{size:"small",onClick:l[3]||(l[3]=e=>f.value=!1)},{default:(0,t.k6)(()=>[...l[7]||(l[7]=[(0,t.eW)("取消",-1)])]),_:1}),(0,t.bF)(L,{size:"small",type:"primary",onClick:y},{default:(0,t.k6)(()=>[...l[8]||(l[8]=[(0,t.eW)("保存",-1)])]),_:1})])])]),_:1},8,["visible"]),l[10]||(l[10]=(0,t.Lk)("div",{class:"divider"},null,-1)),(0,t.Lk)("button",{class:"action-btn save-btn",onClick:b,title:"保存划线"},[(0,t.bF)(u,null,{default:(0,t.k6)(()=>[(0,t.bF)((0,s.R1)(M.Check))]),_:1})]),(0,t.Lk)("button",{class:"action-btn cancel-btn",onClick:R,title:"取消"},[(0,t.bF)(u,null,{default:(0,t.k6)(()=>[(0,t.bF)((0,s.R1)(M.Close))]),_:1})])],36)):(0,t.Q3)("",!0)])}}});const j=(0,$.A)(q,[["__scopeId","data-v-2ff57997"]]);var J=j;const Z={class:"reader-left"},ee={class:"panel-header"},ae={class:"toc-list"},le=["onClick"],te={key:0,class:"toc-empty"},ne={class:"main-container"},ie={class:"main-toolbar"},se={class:"toolbar-right"},ue={key:0,class:"source-tag"},oe={key:1,class:"article-title"},ce={key:2,class:"article-meta"},re={key:0},ve={key:1,class:"separator"},de={key:3,class:"loading-state"},ge={key:4,class:"error-state"},fe=["innerHTML"],ke={key:6,class:"article-footer"},he={class:"reader-right"},pe={class:"panel-header"},me={class:"panel-tabs"},be={key:0,class:"info-content"},ye={class:"info-section"},Re={class:"metadata-list"},Le={class:"metadata-item"},Fe={class:"meta-value"},Ce={class:"metadata-item"},_e={class:"meta-value"},we={class:"metadata-item"},Ee={class:"meta-value"},Ae={class:"metadata-item"},Ke={class:"meta-value"},We={class:"metadata-item"},xe={class:"progress-info"},Xe={class:"progress-text"},Se={class:"metadata-item"},Te={class:"meta-value"},Ie={key:1,class:"notebook-content"},Ve={class:"info-section"},ze={class:"note-input-area"},$e={key:0,class:"note-actions"},He={class:"info-section"},Ne={class:"section-title"},Me={class:"highlight-count"},Ue={key:0,class:"highlights-list"},Qe={class:"highlight-text"},De={key:0,class:"highlight-note"},Oe={key:1,class:"highlight-tags"},Ge={class:"highlight-footer"},Pe={class:"highlight-time"},Be={key:1,class:"highlights-empty"},Ye={class:"reading-progress-bar"};var qe=(0,t.pM)({__name:"Reader",setup(e){const a=(0,u.lq)(),l=(0,u.rd)(),r=(0,o.N)(),v=(0,c.C)(),d=m(),g=L(),f=(0,s.KR)(null),k=(0,s.KR)(null),h=(0,s.KR)(!0),p=(0,s.KR)(!0),b=(0,s.KR)("info"),y=(0,s.KR)(null),R=(0,s.KR)(!1),C=(0,s.KR)(null),_=(0,s.KR)(null),w=(0,s.KR)([]),E=(0,s.KR)(-1),A=(0,s.KR)(0),K=(0,s.KR)(!1),W=(0,s.KR)({x:0,y:0}),x=(0,s.KR)(""),X=(0,s.KR)(null),S=(0,s.KR)(""),T=(0,s.KR)(""),I=(0,t.EW)(()=>_.value||y.value?.description||""),V=(0,t.EW)(()=>{const e=I.value;if(!e||0===d.highlights.length)return e;const a=[...d.highlights].sort((e,a)=>a.startOffset-e.startOffset);let l=e;const t=e.replace(/<[^>]*>/g,"");for(const n of a){const e=n.selectedText,a=t.indexOf(e);if(-1===a)continue;const i=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");new RegExp(`(?<=>)[^<]*?${i}[^<]*?(?=<)`,"g");l=l.replace(e,`<mark class="highlight-mark highlight-${n.color}" data-highlight-id="${n.id}">${e}</mark>`)}return l}),z=(0,t.EW)(()=>{const{fontSize:e,lineHeight:a,fontFamily:l}=v.reading;let t="";switch(l){case"serif":t='Georgia, "Times New Roman", serif';break;case"sans-serif":t='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';break;case"monospace":t='"Fira Code", Consolas, Monaco, monospace';break;default:t="inherit"}return{fontSize:`${e}px`,lineHeight:a,fontFamily:t}}),$=(0,t.EW)(()=>{const e=I.value,a=e.replace(/<[^>]*>/g,"");return a.length}),H=(0,t.EW)(()=>Math.max(1,Math.ceil($.value/300))),M=(0,t.EW)(()=>{if(!y.value?.link)return"";try{const e=new URL(y.value.link);return e.hostname}catch{return""}});async function U(){const e=Number(a.params.id);if(e){R.value=!0,C.value=null,_.value=null;try{y.value=await(0,F.vO)(e),y.value&&0===y.value.isRead&&(await r.markAsRead(e),y.value.isRead=1);const a=[];a.push((0,F.xp)(e).then(e=>{_.value=e}).catch(()=>{console.warn("Failed to load full content, using RSS content instead")})),a.push(d.fetchHighlights(e)),a.push(g.fetchNote(e).then(()=>{S.value=g.note?.noteContent||"",T.value=S.value})),a.push(d.fetchTags()),await Promise.all(a),await(0,t.dY)(),Y()}catch(l){C.value=l.message||"加载文章失败"}finally{R.value=!1}}}function Q(e){const a=window.getSelection();if(!a||a.isCollapsed||!a.toString().trim()){if(!K.value)return;return void setTimeout(()=>{const a=document.querySelector(".highlight-toolbar");a&&!a.contains(e.target)&&D()},100)}if(!k.value?.contains(a.anchorNode))return;const l=a.toString().trim();if(l.length<2)return;x.value=l,X.value=a.getRangeAt(0).cloneRange();const t=a.getRangeAt(0).getBoundingClientRect();W.value={x:t.left+t.width/2,y:t.top-10},K.value=!0}function D(){K.value=!1,x.value="",X.value=null,window.getSelection()?.removeAllRanges()}async function O(e){if(!y.value||!X.value)return;const a=X.value,l=(k.value,document.createRange());l.selectNodeContents(k.value),l.setEnd(a.startContainer,a.startOffset);const t=l.toString().length,n=t+x.value.length,i={articleId:y.value.id,selectedText:x.value,startOffset:t,endOffset:n,color:e.color,note:e.note||void 0,tagNames:e.tags.length>0?e.tags:void 0};try{await d.createHighlight(i),D()}catch(s){console.error("Failed to save highlight:",s)}}async function G(e){try{await d.deleteHighlight(e)}catch(a){console.error("Failed to delete highlight:",a)}}async function P(){if(y.value&&S.value!==T.value)try{await g.saveNote(y.value.id,S.value),T.value=S.value}catch(e){console.error("Failed to save note:",e)}}function B(e){const a=new Date(e),l=new Date,t=l.getTime()-a.getTime();return t<6e4?"just now":t<36e5?`${Math.floor(t/6e4)}m ago`:t<864e5?`${Math.floor(t/36e5)}h ago`:t<6048e5?`${Math.floor(t/864e5)}d ago`:a.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})}function Y(){if(!k.value)return;const e=k.value.querySelectorAll("h1, h2, h3, h4, h5, h6");w.value=Array.from(e).map(e=>{const a=parseInt(e.tagName.charAt(1));return{text:e.textContent?.trim()||"",level:a,element:e}})}function q(e){const a=w.value[e];a?.element&&(a.element.scrollIntoView({behavior:"smooth",block:"start"}),E.value=e)}function j(){if(!f.value)return;const{scrollTop:e,scrollHeight:a,clientHeight:l}=f.value,t=a-l;if(t>0&&(A.value=Math.round(e/t*100)),k.value){const e=w.value;for(let a=e.length-1;a>=0;a--){const l=e[a].element;if(l&&l.getBoundingClientRect().top<=100){E.value=a;break}}}}function qe(e){return new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric"})}function je(){l.back()}async function Je(){y.value&&(1===y.value.isRead?(await r.markAsUnread(y.value.id),y.value.isRead=0):(await r.markAsRead(y.value.id),y.value.isRead=1))}async function Ze(){y.value&&(await r.toggleFavorite(y.value.id),y.value.isFavorite=1===y.value.isFavorite?0:1)}function ea(){y.value?.link&&window.open(y.value.link,"_blank")}function aa(e){"Escape"===e.key?je():"["===e.key?h.value=!h.value:"]"===e.key&&(p.value=!p.value)}function la(e){if(!K.value)return;const a=document.querySelector(".highlight-toolbar");a&&!a.contains(e.target)&&D()}return(0,t.wB)(()=>a.params.id,()=>{U()},{immediate:!0}),(0,t.sV)(()=>{window.addEventListener("keydown",aa),document.addEventListener("click",la)}),(0,t.hi)(()=>{window.removeEventListener("keydown",aa),document.removeEventListener("click",la),d.clearHighlights(),g.clearNote()}),(e,a)=>{const l=(0,t.g2)("Close"),u=(0,t.g2)("el-icon"),o=(0,t.g2)("el-button"),c=(0,t.g2)("DArrowRight"),r=(0,t.g2)("ArrowLeft"),v=(0,t.g2)("el-tag"),m=(0,t.g2)("Loading"),L=(0,t.g2)("Warning"),F=(0,t.g2)("View"),_=(0,t.g2)("Hide"),X=(0,t.g2)("StarFilled"),I=(0,t.g2)("Star"),Y=(0,t.g2)("Link"),aa=(0,t.g2)("DArrowLeft"),la=(0,t.g2)("el-progress"),ta=(0,t.g2)("el-input");return(0,t.uX)(),(0,t.CE)("div",{class:(0,n.C4)(["reader-page",{"hide-left":!h.value,"hide-right":!p.value}])},[(0,t.bo)((0,t.Lk)("aside",Z,[(0,t.Lk)("div",ee,[a[7]||(a[7]=(0,t.Lk)("h3",null,"Contents",-1)),(0,t.bF)(o,{text:"",circle:"",size:"small",onClick:a[0]||(a[0]=e=>h.value=!1)},{default:(0,t.k6)(()=>[(0,t.bF)(u,null,{default:(0,t.k6)(()=>[(0,t.bF)(l)]),_:1})]),_:1})]),(0,t.Lk)("nav",ae,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(w.value,(e,a)=>((0,t.uX)(),(0,t.CE)("div",{key:a,class:(0,n.C4)(["toc-item",[`level-${e.level}`,{active:E.value===a}]]),onClick:e=>q(a)},(0,n.v_)(e.text),11,le))),128)),0!==w.value.length||R.value?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.CE)("div",te," 暂无目录 "))])],512),[[i.aG,h.value]]),(0,t.bo)((0,t.Lk)("button",{class:"toggle-btn toggle-left",onClick:a[1]||(a[1]=e=>h.value=!0)},[(0,t.bF)(u,null,{default:(0,t.k6)(()=>[(0,t.bF)(c)]),_:1})],512),[[i.aG,!h.value]]),(0,t.Lk)("main",{class:"reader-main",ref_key:"mainRef",ref:f,onScroll:j,onMouseup:Q},[(0,t.Lk)("div",ne,[(0,t.Lk)("div",ie,[(0,t.bF)(o,{text:"",onClick:je},{default:(0,t.k6)(()=>[(0,t.bF)(u,null,{default:(0,t.k6)(()=>[(0,t.bF)(r)]),_:1}),a[8]||(a[8]=(0,t.eW)(" 返回 ",-1))]),_:1}),(0,t.Lk)("div",se,[(0,t.bF)(N)])]),y.value?((0,t.uX)(),(0,t.CE)("div",ue,[(0,t.bF)(v,{size:"small",type:"info"},{default:(0,t.k6)(()=>[(0,t.eW)((0,n.v_)(y.value.feedName),1)]),_:1})])):(0,t.Q3)("",!0),y.value?((0,t.uX)(),(0,t.CE)("h1",oe,(0,n.v_)(y.value.title),1)):(0,t.Q3)("",!0),y.value?((0,t.uX)(),(0,t.CE)("div",ce,[y.value.author?((0,t.uX)(),(0,t.CE)("span",re,(0,n.v_)(y.value.author),1)):(0,t.Q3)("",!0),y.value.author?((0,t.uX)(),(0,t.CE)("span",ve,"·")):(0,t.Q3)("",!0),(0,t.Lk)("span",null,(0,n.v_)(H.value)+" min read",1),a[9]||(a[9]=(0,t.Lk)("span",{class:"separator"},"·",-1)),(0,t.Lk)("span",null,(0,n.v_)(qe(y.value.pubDate)),1)])):(0,t.Q3)("",!0),R.value?((0,t.uX)(),(0,t.CE)("div",de,[(0,t.bF)(u,{class:"is-loading",size:32},{default:(0,t.k6)(()=>[(0,t.bF)(m)]),_:1}),a[10]||(a[10]=(0,t.Lk)("p",null,"正在加载原文内容...",-1))])):C.value?((0,t.uX)(),(0,t.CE)("div",ge,[(0,t.bF)(u,{size:32},{default:(0,t.k6)(()=>[(0,t.bF)(L)]),_:1}),(0,t.Lk)("p",null,(0,n.v_)(C.value),1),(0,t.bF)(o,{type:"primary",onClick:U},{default:(0,t.k6)(()=>[...a[11]||(a[11]=[(0,t.eW)("重试",-1)])]),_:1})])):((0,t.uX)(),(0,t.CE)("article",{key:5,class:"article-content",style:(0,n.Tr)(z.value),ref_key:"contentRef",ref:k,innerHTML:V.value},null,12,fe)),y.value&&!R.value?((0,t.uX)(),(0,t.CE)("div",ke,[(0,t.bF)(o,{onClick:Je},{default:(0,t.k6)(()=>[(0,t.bF)(u,null,{default:(0,t.k6)(()=>[0===y.value.isRead?((0,t.uX)(),(0,t.Wv)(F,{key:0})):((0,t.uX)(),(0,t.Wv)(_,{key:1}))]),_:1}),(0,t.eW)(" "+(0,n.v_)(1===y.value.isRead?"标为未读":"标为已读"),1)]),_:1}),(0,t.bF)(o,{onClick:Ze},{default:(0,t.k6)(()=>[(0,t.bF)(u,null,{default:(0,t.k6)(()=>[1===y.value.isFavorite?((0,t.uX)(),(0,t.Wv)(X,{key:0})):((0,t.uX)(),(0,t.Wv)(I,{key:1}))]),_:1}),(0,t.eW)(" "+(0,n.v_)(1===y.value.isFavorite?"取消收藏":"收藏"),1)]),_:1}),(0,t.bF)(o,{onClick:ea},{default:(0,t.k6)(()=>[(0,t.bF)(u,null,{default:(0,t.k6)(()=>[(0,t.bF)(Y)]),_:1}),a[12]||(a[12]=(0,t.eW)(" 查看原文 ",-1))]),_:1})])):(0,t.Q3)("",!0)])],544),(0,t.bo)((0,t.Lk)("button",{class:"toggle-btn toggle-right",onClick:a[2]||(a[2]=e=>p.value=!0)},[(0,t.bF)(u,null,{default:(0,t.k6)(()=>[(0,t.bF)(aa)]),_:1})],512),[[i.aG,!p.value]]),(0,t.bo)((0,t.Lk)("aside",he,[(0,t.Lk)("div",pe,[(0,t.Lk)("div",me,[(0,t.Lk)("span",{class:(0,n.C4)(["tab",{active:"info"===b.value}]),onClick:a[3]||(a[3]=e=>b.value="info")},"Info",2),(0,t.Lk)("span",{class:(0,n.C4)(["tab",{active:"notebook"===b.value}]),onClick:a[4]||(a[4]=e=>b.value="notebook")},"Notebook",2)]),(0,t.bF)(o,{text:"",circle:"",size:"small",onClick:a[5]||(a[5]=e=>p.value=!1)},{default:(0,t.k6)(()=>[(0,t.bF)(u,null,{default:(0,t.k6)(()=>[(0,t.bF)(l)]),_:1})]),_:1})]),y.value&&"info"===b.value?((0,t.uX)(),(0,t.CE)("div",be,[(0,t.Lk)("div",ye,[a[21]||(a[21]=(0,t.Lk)("h4",{class:"section-title"},"METADATA",-1)),(0,t.Lk)("div",Re,[a[20]||(a[20]=(0,t.Lk)("div",{class:"metadata-item"},[(0,t.Lk)("span",{class:"meta-label"},"Type"),(0,t.Lk)("span",{class:"meta-value"},"RSS Feed")],-1)),(0,t.Lk)("div",Le,[a[13]||(a[13]=(0,t.Lk)("span",{class:"meta-label"},"Source",-1)),(0,t.Lk)("span",Fe,(0,n.v_)(y.value.feedName),1)]),(0,t.Lk)("div",Ce,[a[14]||(a[14]=(0,t.Lk)("span",{class:"meta-label"},"Domain",-1)),(0,t.Lk)("span",_e,(0,n.v_)(M.value),1)]),(0,t.Lk)("div",we,[a[15]||(a[15]=(0,t.Lk)("span",{class:"meta-label"},"Published",-1)),(0,t.Lk)("span",Ee,(0,n.v_)(qe(y.value.pubDate)),1)]),(0,t.Lk)("div",Ae,[a[16]||(a[16]=(0,t.Lk)("span",{class:"meta-label"},"Words",-1)),(0,t.Lk)("span",Ke,(0,n.v_)($.value)+" 字",1)]),(0,t.Lk)("div",We,[a[17]||(a[17]=(0,t.Lk)("span",{class:"meta-label"},"Progress",-1)),(0,t.Lk)("div",xe,[(0,t.bF)(la,{percentage:A.value,"stroke-width":4,"show-text":!1},null,8,["percentage"]),(0,t.Lk)("span",Xe,(0,n.v_)(A.value)+"%",1)])]),(0,t.Lk)("div",Se,[a[19]||(a[19]=(0,t.Lk)("span",{class:"meta-label"},"Status",-1)),(0,t.Lk)("span",Te,[(0,t.bF)(v,{type:1===y.value.isRead?"info":"success",size:"small"},{default:(0,t.k6)(()=>[(0,t.eW)((0,n.v_)(1===y.value.isRead?"已读":"未读"),1)]),_:1},8,["type"]),1===y.value.isFavorite?((0,t.uX)(),(0,t.Wv)(v,{key:0,type:"warning",size:"small",style:{"margin-left":"4px"}},{default:(0,t.k6)(()=>[...a[18]||(a[18]=[(0,t.eW)(" 已收藏 ",-1)])]),_:1})):(0,t.Q3)("",!0)])])])])])):(0,t.Q3)("",!0),y.value&&"notebook"===b.value?((0,t.uX)(),(0,t.CE)("div",Ie,[(0,t.Lk)("div",Ve,[a[23]||(a[23]=(0,t.Lk)("h4",{class:"section-title"},"DOCUMENT NOTE",-1)),(0,t.Lk)("div",ze,[(0,t.bF)(ta,{modelValue:S.value,"onUpdate:modelValue":a[6]||(a[6]=e=>S.value=e),type:"textarea",rows:4,placeholder:"Write your notes about this article...",onBlur:P},null,8,["modelValue"]),S.value!==T.value?((0,t.uX)(),(0,t.CE)("div",$e,[(0,t.bF)(o,{size:"small",type:"primary",onClick:P,loading:(0,s.R1)(g).saving},{default:(0,t.k6)(()=>[...a[22]||(a[22]=[(0,t.eW)(" Save ",-1)])]),_:1},8,["loading"])])):(0,t.Q3)("",!0)])]),(0,t.Lk)("div",He,[(0,t.Lk)("h4",Ne,[a[24]||(a[24]=(0,t.eW)(" HIGHLIGHTS ",-1)),(0,t.Lk)("span",Me,"("+(0,n.v_)((0,s.R1)(d).highlights.length)+")",1)]),(0,s.R1)(d).highlights.length>0?((0,t.uX)(),(0,t.CE)("div",Ue,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)((0,s.R1)(d).highlights,e=>((0,t.uX)(),(0,t.CE)("div",{key:e.id,class:(0,n.C4)(["highlight-item",[`highlight-${e.color}`]])},[(0,t.Lk)("div",Qe,'"'+(0,n.v_)(e.selectedText)+'"',1),e.note?((0,t.uX)(),(0,t.CE)("div",De,(0,n.v_)(e.note),1)):(0,t.Q3)("",!0),e.tags&&e.tags.length>0?((0,t.uX)(),(0,t.CE)("div",Oe,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(e.tags,e=>((0,t.uX)(),(0,t.Wv)(v,{key:e.id,size:"small",type:"info"},{default:(0,t.k6)(()=>[(0,t.eW)((0,n.v_)(e.name),1)]),_:2},1024))),128))])):(0,t.Q3)("",!0),(0,t.Lk)("div",Ge,[(0,t.Lk)("span",Pe,(0,n.v_)(B(e.createTime)),1),(0,t.bF)(o,{text:"",size:"small",type:"danger",onClick:a=>G(e.id)},{default:(0,t.k6)(()=>[...a[25]||(a[25]=[(0,t.eW)(" Delete ",-1)])]),_:1},8,["onClick"])])],2))),128))])):((0,t.uX)(),(0,t.CE)("div",Be,[...a[26]||(a[26]=[(0,t.Lk)("p",null,"No highlights yet",-1),(0,t.Lk)("p",{class:"hint"},"Select text in the article to create highlights",-1)])]))])])):(0,t.Q3)("",!0)],512),[[i.aG,p.value]]),(0,t.Lk)("div",Ye,[(0,t.Lk)("div",{class:"progress-fill",style:(0,n.Tr)({width:A.value+"%"})},null,4)]),(0,t.bF)(J,{visible:K.value,position:W.value,"selected-text":x.value,"all-tags":(0,s.R1)(d).tags,onSave:O,onCancel:D},null,8,["visible","position","selected-text","all-tags"])],2)}}});const je=(0,$.A)(qe,[["__scopeId","data-v-53a5d857"]]);var Je=je},6933:function(e,a,l){l.d(a,{N:function(){return o}});l(4114),l(8111),l(2489),l(116),l(7588),l(1701);var t=l(2261),n=l(6768),i=l(144),s=l(1256),u=l(7580);const o=(0,t.nY)("article",()=>{const e=(0,i.KR)([]),a=(0,i.KR)(null),l=(0,i.KR)(!1),t=(0,i.KR)(!0),o=(0,i.KR)(0),c=(0,i.KR)({page:1,size:20,feedId:void 0,isRead:void 0,isFavorite:void 0}),r=(0,n.EW)(()=>e.value.filter(e=>0===e.isRead));async function v(a=!1){if(a&&(c.value.page=1,e.value=[],t.value=!0),t.value){l.value=!0;try{const l=await s.GE(c.value);a?e.value=l.data:e.value.push(...l.data),o.value=l.total,t.value=c.value.page<l.totalPages,c.value.page++}finally{l.value=!1}}}async function d(e){l.value=!0;try{a.value=await s.vO(e),a.value&&0===a.value.isRead&&await g(e)}finally{l.value=!1}}async function g(l){await s.aI(l);const t=e.value.find(e=>e.id===l);if(t&&0===t.isRead){t.isRead=1;const e=(0,u.p)();e.decreaseUnreadCount(t.feedId)}a.value?.id===l&&(a.value.isRead=1)}async function f(l){await s.lF(l);const t=e.value.find(e=>e.id===l);if(t&&1===t.isRead){t.isRead=0;const e=(0,u.p)();e.increaseUnreadCount(t.feedId)}a.value?.id===l&&(a.value.isRead=0)}async function k(){const a=e.value.filter(e=>0===e.isRead).map(e=>e.id);if(0===a.length)return;await s.YE(a);const l=(0,u.p)();e.value.forEach(e=>{0===e.isRead&&(e.isRead=1,l.decreaseUnreadCount(e.feedId))})}async function h(l){await s.dw(l);const t=e.value.find(e=>e.id===l);t&&(t.isFavorite=1===t.isFavorite?0:1),a.value?.id===l&&(a.value.isFavorite=1===a.value.isFavorite?0:1)}function p(e){c.value={...c.value,...e,page:1}}function m(){a.value=null}return{articles:e,currentArticle:a,loading:l,hasMore:t,total:o,queryParams:c,unreadArticles:r,fetchArticles:v,fetchArticle:d,markAsRead:g,markAsUnread:f,markAllAsRead:k,toggleFavorite:h,setFilter:p,clearCurrentArticle:m}})}}]);
//# sourceMappingURL=310.b0c08e6a.js.map